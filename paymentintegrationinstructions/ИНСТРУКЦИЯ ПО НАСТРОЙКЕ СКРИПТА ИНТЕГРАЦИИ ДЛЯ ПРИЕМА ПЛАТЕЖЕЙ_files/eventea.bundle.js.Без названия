!function(){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var n,r,o={},i={},s={},a={};function u(){if(n)return a;n=1;const e="eventeaStatist",t="onEventeaStatist";class r{constructor(n){var o;this.instance=null,this.resolveInstance=()=>{},this.instancePromise=new Promise((e=>{this.resolveInstance=e})),this.updateClientParameters=(...e)=>{if(this.instance)return this.instance.updateClientParameters(...e);this.instancePromise.then((t=>t.updateClientParameters(...e)))},this.updateABGroups=(...e)=>{if(this.instance)return this.instance.updateABGroups(...e);this.instancePromise.then((t=>t.updateABGroups(...e)))},this.send=(...e)=>{if(this.instance)return this.instance.send(...e);this.instancePromise.then((t=>t.send(...e)))},this.fork=(...e)=>new r({isForked:!0,forkOptions:e});const i=e=>{this.instance=(null==n?void 0:n.isForked)?e.fork(...n.forkOptions):e,this.resolveInstance(this.instance)},s=window[e];if(s)return void i(s);void 0===window[t]&&(window[t]=[],Object.defineProperty(window,e,{set:n=>{var r;null===(r=window[t])||void 0===r||r.forEach((e=>e(n))),delete window[t],delete window[e],window[e]=n},configurable:!0})),null===(o=window[t])||void 0===o||o.push((e=>i(e)))}}return a.EventeaStatistQueue=r,a}function c(){if(r)return s;r=1;var e=u();const t="undefined"!=typeof window?window:void 0;return s.EventeaStatistQueue=e.EventeaStatistQueue,s.EventeaQueue=class{__addEventToStore(...e){(null==t?void 0:t._evnteq)&&t._evnteq.push(...e)}get getQueue(){var e;return Array.isArray(null==t?void 0:t._evnteq)?null==t?void 0:t._evnteq:null===(e=null==t?void 0:t._evnteq)||void 0===e?void 0:e.queue}constructor(e){var n,r;this.errorHandlers=null==e?void 0:e.errorHandlers,t?!t._evnteq&&(t._evnteq=[]):null===(r=null===(n=this.errorHandlers)||void 0===n?void 0:n.handleQueueUsageAtServer)||void 0===r||r.call(n)}send(e){this.__addEventToStore(["send",e])}sendOnce(e,t){return this.__addEventToStore(["sendOnce",e,t]),!0}data(e){this.__addEventToStore(["data",e])}},s.EventeaQueueObserver=class{set watch(e){var t,n;this.observerSuspended?null===(n=null===(t=this.errorHandlers)||void 0===t?void 0:t.handleQueueUsageAtServer)||void 0===n||n.call(t):(this.watcher=e,this.push(...this.queue),this.queue=[])}push(...e){var t,n;if(this.watcher)try{this.watcher(e)}catch(e){const{message:r}=e;null===(n=null===(t=this.errorHandlers)||void 0===t?void 0:t.handleObserverWatcherErrors)||void 0===n||n.call(t,r)}else this.queue.push(...e)}constructor(e){var n,r;this.observerSuspended=!1,this.queue=[],this.errorHandlers=null==e?void 0:e.errorHandlers,t?(Array.isArray(t._evnteq)&&this.queue.push(...t._evnteq),t._evnteq=this):(this.observerSuspended=!0,null===(r=null===(n=this.errorHandlers)||void 0===n?void 0:n.handleQueueUsageAtServer)||void 0===r||r.call(n))}},s}var l,d,f={},p={},h={};function v(){if(l)return h;return l=1,h.gzipCompress=function(e){const t=new CompressionStream("gzip"),n=new Blob([e]).stream().pipeThrough(t);return new Response(n)},h}function g(){if(d)return p;d=1;var e=v();function t(){return"undefined"!=typeof document&&"hidden"===document.visibilityState}function n(e){const t=JSON.stringify(e);return new Blob([t]).size}return p.EventeaBeerClient=class{constructor(e){var t;if(this.batch=[],this.timer=null,"undefined"==typeof window)throw new Error("Eventea beer client is not isomorphic package");const{baseUrl:n,batching:r,needBoxyBlocksProcessing:o,priority:i="auto",compressionEnabled:s=!1}=e;this._request=e=>fetch(`${n}${e.method}`,{...e,method:e.httpMethod,priority:i}).then((e=>e.json())),this.batchingEnable=(null==r?void 0:r.batchingEnable)||!1;const a="undefined"!=typeof window&&"CompressionStream"in window;if(this.batchMaxLen=a?(null==r?void 0:r.batchSize)||50:Math.min((null==r?void 0:r.batchSize)||50,50),this.batchDelay=(null==r?void 0:r.batchDelay)||50,this.needBoxyBlocksProcessing=o||!1,this.compressionEnabled=s,"undefined"!=typeof document){const e=null===(t=document.cookie.match(/(?:^|;\s*)beerBatchCompression=([^;]+)/))||void 0===t?void 0:t[1];this.compressionEnabled=(s||"on"===e)&&"off"!==e,document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&this.flushEvents()}))}}event(e){const t=this.formatEvent(e);return this.batchingEnable?(this.enqueue(t),Promise.resolve()):this.sendImmediately(t)}sendAbstractEvent(e){return this.event(e)}formatEvent(e){var t,n,r,o,i;const s=(null===(t=e.handlersData)||void 0===t?void 0:t.blockType)||(null===(n=e.payload)||void 0===n?void 0:n.blockType),a=(null===(r=e.handlersData)||void 0===r?void 0:r.blockProject)||(null===(o=e.payload)||void 0===o?void 0:o.blockProject);let u=e.event,c=e.project;if(this.needBoxyBlocksProcessing&&"boxy"===e.project){const e={"block.renderingStatus":"microfront-rendering-status"};Object.keys(e).includes(u)&&(u=e[u],c="supreme")}return{project:c,event:u,payload:{...e.payload||{},appName:null===(i=e.handlersData)||void 0===i?void 0:i.appName,blockType:s,blockProject:a}}}prepareRequestBody(t,n=!1){const r=Array.isArray(t),o="function"==typeof CompressionStream,i=JSON.stringify(t);let s=i,a="application/json",u=i.length;const c={body:i,contentType:"application/json",contentSize:u};return this.compressionEnabled&&o&&!n&&r?{async next(){try{s=await e.gzipCompress(i).arrayBuffer(),u=s.byteLength,a="application/octet-stream"}catch(e){console.error("Batch compression failed:",e)}return{body:s,contentType:a,contentSize:u}}}:c}async sendRequest(e,t){const n=this.prepareRequestBody(e,t),{body:r,contentType:o,contentSize:i}=n.next?await n.next():n;return this._request({method:"event",httpMethod:"POST",body:r,headers:{"content-type":o},credentials:"omit",keepalive:64e3>i}).catch((()=>{}))}sendImmediately(e){return this.sendRequest(e,t())}enqueue(e){64e3>n([e])||this.sendRequest({project:"eventea",event:"keepAliveDataExceed",payload:{eventName:e.event}},!0);32e3>n([...this.batch,e])||this.flushEvents(),this.batch.push(e);n(this.batch)>=32e3||this.batch.length>=this.batchMaxLen?this.sendBatch():1===this.batch.length&&(this.timer=setTimeout((()=>{this.sendBatch()}),this.batchDelay))}async sendBatch(){const e=this.batch;this.batch=[],this.timer&&(clearTimeout(this.timer),this.timer=null),0!==e.length&&await this.sendRequest(e,t())}flushEvents(){this.sendBatch()}},p}var m,y={};function b(){if(m)return y;m=1;return y.EventeaDataState=class{constructor(e){this.__state={},(null==e?void 0:e.initData)&&e.initData&&(this.__state=e.initData)}add(e){const{project:t,payload:n}=e;this.__state[t]={...this.__state[t],...n}}get(e,t){if(!this.__state[e])return;return this.__state[e][t]}get _getAll(){return this.__state}},y}var S,w={};function E(){if(S)return w;S=1;const e="undefined"!=typeof window?window:void 0;return w.sendPostMessage=function({type:t,payload:n,config:r={}}){const{targetOrigin:o="*",payloadProperty:i}=r;e&&(e.top||e.opener||e.parent).postMessage(JSON.stringify({type:t,...i?{[i]:n}:n}),o)},w}var j,k={},_={};function P(){return j||(j=1,(e=_).EventeaFeaturesBits=void 0,(t=e.EventeaFeaturesBits||(e.EventeaFeaturesBits={}))[t.DiagStats=1]="DiagStats"),_;var e,t}var C,M,O={};function R(){return C||(C=1,(e=O).IncompleteReason=void 0,(t=e.IncompleteReason||(e.IncompleteReason={}))[t.MissedProject=0]="MissedProject",t[t.MissedRouting=1]="MissedRouting",t[t.MissedEvent=2]="MissedEvent",t[t.MissedRoutes=3]="MissedRoutes",e.SentStatus=void 0,(n=e.SentStatus||(e.SentStatus={}))[n.Routed=0]="Routed",n[n.IncompleteRouting=1]="IncompleteRouting",n[n.Deprecated=2]="Deprecated",n[n.Dead=3]="Dead",e.HandlerStatus=void 0,(r=e.HandlerStatus||(e.HandlerStatus={}))[r.Handled=0]="Handled",r[r.MissedHandler=1]="MissedHandler",r[r.HandlerErrored=2]="HandlerErrored",e.DiagMessageType=void 0,(o=e.DiagMessageType||(e.DiagMessageType={}))[o.SendStart=0]="SendStart",o[o.SentStats=1]="SentStats",e.sendDiagMessage=function(e){if("undefined"!=typeof window)try{const t=new CustomEvent("__evntx10t",{bubbles:!0,detail:e});document.dispatchEvent(t)}catch(e){}}),O;var e,t,n,r,o}function D(){return M||(M=1,function(e){var t=P(),n=R();Object.defineProperty(e,"EventeaFeaturesBits",{enumerable:!0,get:function(){return t.EventeaFeaturesBits}}),Object.defineProperty(e,"DiagMessageType",{enumerable:!0,get:function(){return n.DiagMessageType}}),Object.defineProperty(e,"HandlerStatus",{enumerable:!0,get:function(){return n.HandlerStatus}}),Object.defineProperty(e,"IncompleteReason",{enumerable:!0,get:function(){return n.IncompleteReason}}),Object.defineProperty(e,"SentStatus",{enumerable:!0,get:function(){return n.SentStatus}}),e.sendDiagMessage=n.sendDiagMessage}(k)),k}var T,H,A,I,L={};function x(){if(T)return L;function e(e,t){return("string"==typeof e||"number"==typeof e||"boolean"==typeof e)&&t.includes(e)}return T=1,L.filterPayloadByWhitelist=function(t,n){const r={...t};for(const o in n)if(o in t&&o in n)for(const i in n[o])if(i in t){e(t[i],n[o][i])||delete r[o]}else delete r[o];return r},L}function U(){if(H)return f;H=1;var e=g(),t=b(),n=E(),r=D(),o=x();class i{constructor(o){if(this.defaultEventHandlers={...o.defaultEventHandlers},this.defaultDataHandlers={...o.defaultDataHandlers},"undefined"==typeof window||window.__evntfxb1ts||(window.__evntfxb1ts=r.EventeaFeaturesBits.DiagStats),this.defaultEventHandlers.postMessage=({event:e,config:t,payload:r})=>n.sendPostMessage({type:e,config:t,payload:r}),o.beerBaseUrl){const t=new e.EventeaBeerClient({baseUrl:o.beerBaseUrl,batching:o.batchingConfig,needBoxyBlocksProcessing:o.needBoxyBlocksProcessing,priority:o.fetchPriority,compressionEnabled:o.compressionEnabled});this.defaultEventHandlers["eventea-beer"]=e=>null==t?void 0:t.sendAbstractEvent(e)}this.routingClientLoader=o.routingClientLoader,this.projectConfigurationMap=o.projectConfigurationMap,this.errorHandlers=o.errorHandlers,this.handlersData=o.handlersData||{},this.onceSentEvents=o.onceSentEvents||new Map,this.handleAnyEvent=o.handleAnyEvent,this.eventeaDataState=new t.EventeaDataState({initData:o.data}),this.eventeaReferenceDataState=o.referenceData}doSend(e){var t,n,i,s;const{project:a,event:u}=e,c=this.projectConfigurationMap[a];let l=e;const d=t=>r.sendDiagMessage({type:r.DiagMessageType.SentStats,event:e,stats:t});if(!c)return this.errorHandlers.handleMissedProject({event:u,project:a}),void d({status:r.SentStatus.IncompleteRouting,reason:r.IncompleteReason.MissedProject});const f=c.routing;if(!f)return this.errorHandlers.handleMissedRouting({project:a}),void d({status:r.SentStatus.IncompleteRouting,reason:r.IncompleteReason.MissedProject});const p=f.events;if(!p)return this.errorHandlers.handleMissedRouting({project:a}),void d({status:r.SentStatus.IncompleteRouting,reason:r.IncompleteReason.MissedRouting});const h=p[u];if(!h)return this.errorHandlers.handleMissedEvent({event:u,project:a}),void d({status:r.SentStatus.IncompleteRouting,reason:r.IncompleteReason.MissedEvent});if(l.payload&&"allowIfMatch"in h&&h.allowIfMatch&&(l.payload=o.filterPayloadByWhitelist(l.payload,h.allowIfMatch)),"fromData"in h&&h.fromData){const{fromData:e}=h,t={};Object.keys(e).forEach((n=>{const r=this.getDataFromState(a,n,e);void 0!==r&&(t[n]=r)})),l={...l,payload:{...t,...l.payload}}}let v=this.handlersData;if(f.statist&&(v={...v,statist:f.statist}),this.handleAnyEvent&&this.handleAnyEvent({...l,eventRouting:h,handlersData:v}),"isDeprecated"in h&&h.isDeprecated)return null===(n=(t=this.errorHandlers).handleDeprecatedEvent)||void 0===n||n.call(t,{event:u,project:a}),void d({status:r.SentStatus.Deprecated});if(!("routes"in h))return null===(s=(i=this.errorHandlers).handleMissedRoutes)||void 0===s||s.call(i,{event:u,project:a}),void d({status:r.SentStatus.IncompleteRouting,reason:r.IncompleteReason.MissedRoutes});const g=Object.getOwnPropertyNames(h.routes);if(this.debugLogEvent(e,g),0==g.length)d({status:r.SentStatus.Dead});else{const t={};g.forEach((n=>{var o;const i=(null===(o=c.eventHandlers)||void 0===o?void 0:o[n])||this.defaultEventHandlers[n];if(!i)return this.errorHandlers.handleMissedEventHandler({project:a,event:u,routeHandlerName:n}),void(t[n]={status:r.HandlerStatus.MissedHandler});if(e.ignoreStatist&&["statist","tracking"].indexOf(n)>=0)return;const s=h.routes[n],d={...l,config:s,handlersData:v};try{i(d),t[n]={status:r.HandlerStatus.Handled}}catch(e){if(t[n]={status:r.HandlerStatus.HandlerErrored,error:e},!this.errorHandlers.handleEventHandlerError)throw e;this.errorHandlers.handleEventHandlerError(e,n,d)}})),d({status:r.SentStatus.Routed,routesStats:t})}}send(e){const t=e;r.sendDiagMessage({type:r.DiagMessageType.SendStart,event:t});const{project:n}=t,o=this.projectConfigurationMap[n];(null==o?void 0:o.routing)||!this.routingClientLoader?this.doSend(t):this.restoreProjectConfiguration(n).catch((()=>{r.sendDiagMessage({type:r.DiagMessageType.SentStats,event:t,stats:{status:r.SentStatus.IncompleteRouting,reason:r.IncompleteReason.MissedProject}})})).then((()=>{this.doSend(t)}))}sendOnce(e,t=!0,n=[]){const r=e,o=`${r.project}/${r.event}`;this.onceSentEvents.has(o)||this.onceSentEvents.set(o,new Set);const i=this.onceSentEvents.get(o);return!i.has(t)&&(this.send(r),n.forEach((e=>{i.add(e)})),i.add(t),!0)}doData(e){var t,n,r,o;const{project:i}=e,s=this.projectConfigurationMap[i];if(!s)return void(null===(n=(t=this.errorHandlers).handleMissedDataProject)||void 0===n||n.call(t,{project:i}));const{dataHandlers:a={}}=s,u={...this.defaultDataHandlers,...a};for(const t of Object.keys(u)){const n=u[t];"function"==typeof n?n(e):null===(o=(r=this.errorHandlers).handleMissedDataHandler)||void 0===o||o.call(r,{project:i,handlerName:t})}this.eventeaDataState.add(e)}data(e){const t=e,{project:n}=t,r=this.projectConfigurationMap[n];(null==r?void 0:r.routing)||!this.routingClientLoader?this.doData(t):this.restoreProjectConfiguration(n).finally((()=>{this.doData(t)}))}restoreProjectConfiguration(e){const t=this.projectConfigurationMap[e];return!(null==t?void 0:t.routing)&&this.routingClientLoader?this.routingClientLoader.getRouting(e).then((n=>{t?t.routing=n:this.projectConfigurationMap[e]={routing:n}}),(t=>{var n,r;throw t||null===(r=(n=this.errorHandlers).handleMissedClientRouting)||void 0===r||r.call(n,{project:e}),t})):Promise.resolve()}replicateWithData(e){const t={...this.eventeaDataState._getAll,...null==e?void 0:e.additionalDataState};return new i({errorHandlers:this.errorHandlers,handlersData:{...this.handlersData,...null==e?void 0:e.additionalHandlersData},projectConfigurationMap:this.projectConfigurationMap,onceSentEvents:this.onceSentEvents,defaultEventHandlers:this.defaultEventHandlers,defaultDataHandlers:this.defaultDataHandlers,data:t})}getDataFromState(e,t,n){var r,o;const i=n[t];return null!==(r=this.eventeaDataState.get(e,i))&&void 0!==r?r:null===(o=this.eventeaReferenceDataState)||void 0===o?void 0:o.get(e,i)}debugLogEvent(e,t){try{if("undefined"!=typeof window&&window.localStorage.getItem("eventeaLog")){const{project:n,event:r,payload:o,ignoreStatist:i}=e,s=i?t.filter((e=>"statist"!==e)):t;console.log(`%c[Eventea]%c send event %c${n}/${r}%c to [${s.length?s.join(","):"0 routes"}]`,"background: yellow","","font-weight: bold","",null!=o?o:"")}}catch(e){}}}return f.Eventea=i,f}function q(){if(A)return i;A=1;var e=c(),t=U();return i.RootEventea=class extends t.Eventea{constructor(t){super(t),this.eventeaQueueObserver=new e.EventeaQueueObserver({errorHandlers:{handleQueueUsageAtServer:this.errorHandlers.handleQueueUsageAtServer,handleObserverWatcherErrors:this.errorHandlers.handleObserverWatcherErrors}}),this.eventeaQueueObserver.watch=e=>{e.forEach((([e,...t])=>{var n,r,o,i;try{switch(e){case"send":this.send(...t);break;case"sendOnce":this.sendOnce(...t);break;case"data":this.data(...t);break;default:null===(r=(n=this.errorHandlers).handleUnknownMethodInQueue)||void 0===r||r.call(n,{requestType:e})}}catch(n){null===(i=(o=this.errorHandlers).handleErrorQueueEvent)||void 0===i||i.call(o,{requestType:e,requestData:t[0]})}}))}}createChild(e){const n=e.copyParentHandlersData?{...this.handlersData,...null==e?void 0:e.handlersData}:e.handlersData;return new t.Eventea({referenceData:e.includeParentDataState?this.eventeaDataState:void 0,defaultDataHandlers:this.defaultDataHandlers,defaultEventHandlers:this.defaultEventHandlers,errorHandlers:this.errorHandlers,handlersData:n,projectConfigurationMap:this.projectConfigurationMap,routingClientLoader:this.routingClientLoader})}},i}function N(){if(I)return o;I=1;var e=q();return o.Eventea=e.RootEventea,o.RootEventea=e.RootEventea,o}var $,B=N(),z={},F={},V={},J={};function Q(){if($)return J;$=1;const e=async e=>{const{timeout:t=5e3,url:n}=e,r=new AbortController,o=((e,t)=>setTimeout((()=>e.abort()),t))(r,t),i=await fetch(n,{...e,signal:r.signal});return clearTimeout(o),i},t=e=>{const t={timeout:null==e?void 0:e.timeout,retry:null==e?void 0:e.retry,retryTimeout:null==e?void 0:e.retryTimeout};return t.retry=t.retry?t.retry:t.timeout&&t.retryTimeout?t.timeout/t.retryTimeout:2,t.retryTimeout=t.retryTimeout?t.retryTimeout:t.timeout&&t.retry?t.timeout/t.retry:2500,t.timeout=t.timeout?t.timeout:t.retryTimeout&&t.retry?t.retryTimeout*t.retry:15e3,t};return J.handleRetryOptions=t,J.requestWithRetry=async(n,r)=>{var o;const{retry:i,retryTimeout:s}=t(r);let a,u,c;for(const t of function*(){let t=0;for(;i>t;)yield e({url:n,timeout:s}),t+=1}())try{a=await t;break}catch(e){u=e;continue}if(!a)throw u;return(null===(o=a.headers.get("content-type"))||void 0===o?void 0:o.includes("application/json"))?c=await a.json():a&&(c=await a.text()),{status:a.status,body:c}},J}var W,G,K,Z,X={};function Y(){if(W)return X;W=1;return X.routingValidator={check:e=>{if(e&&"object"==typeof e){return!(!e.version||!e.events||"v4"!==e.version)}return!1},getErrors:e=>[`${JSON.stringify(e)}: doesn't match a valid v4 routing schema`]},X}function ee(){if(G)return V;G=1;var e=Q(),t=Y();return V.requestWithRetry=e.requestWithRetry,V.ClientSingleLoader=class{constructor(n){this.currentRequest=null,this.makeRequest=()=>{this.currentRequest=this.request(this.url,{timeout:this.timeout}),this.currentRequest.then((e=>{400>e.status?t.routingValidator.check(e.body)?this.currentRouting=e.body:this.handleRequestError({project:this.project,validationErrors:t.routingValidator.getErrors(e.body)}):this.handleRequestError({project:this.project,status:e.status})}),(e=>{this.handleRequestError({project:this.project,reason:e})})).finally((()=>{this.currentRequest=null}))};const{url:r,baseUrl:o,projectName:i,timeout:s=5e3,fallback:a}=n;if(this.project=i,this.url=r||((e,t)=>{let n=t;return t.endsWith("/")||(n+="/"),`${n}v4/${e}.json`})(i,o),this.handleRequestError=n.handleRequestError,this.timeout=s,this.request=e.requestWithRetry,a){if(!t.routingValidator.check(a)){const e=t.routingValidator.getErrors(n.fallback);throw new Error(`fallback должен быть валидным роутингом:\n${e.join("\n")}`)}this.fallback=a}}handleRequest(){this.currentRouting||this.currentRequest||this.makeRequest()}getRouting(){return this.handleRequest(),this.currentRouting?Promise.resolve(this.currentRouting):this.currentRequest?this.currentRequest.then((()=>{const e=this.currentRouting||this.fallback;return e||Promise.reject(void 0)}),(()=>this.fallback?this.fallback:Promise.reject(void 0))):Promise.reject(void 0)}},V}function te(){if(K)return F;K=1;var e=ee();const t=()=>({});return F.ClientLoader=class{constructor(n){this.projectSingleLoaders={},this.getSingleLoaderInstance=t=>new e.ClientSingleLoader({projectName:"string"==typeof t?t:t.projectName,fallback:"string"==typeof t?void 0:t.fallback,handleRequestError:this.handleRequestError,timeout:this.timeout,baseUrl:this.baseUrl}),this.getPreloadRoutings=()=>{for(const e of this.preloadProjects){const t="string"==typeof e?e:e.projectName;this.projectSingleLoaders[t]=this.getSingleLoaderInstance(e),this.projectSingleLoaders[t].handleRequest()}},this.addNewLoaderInstance=e=>(this.projectSingleLoaders[e]=this.getSingleLoaderInstance(e),this.projectSingleLoaders[e]);const{baseUrl:r,preloadProjects:o,timeout:i,handleRequestError:s}=n;this.preloadProjects=o,this.baseUrl=r,this.timeout=i,this.handleRequestError=s||t,this.getPreloadRoutings()}async getRouting(e){return e in this.projectSingleLoaders?this.projectSingleLoaders[e].getRouting():this.addNewLoaderInstance(e).getRouting()}},F}function ne(){return Z||(Z=1,z.ClientLoader=te().ClientLoader),z}var re=ne();const oe={info:!0,warn:!0,error:!0,debug:!0,trace:!0,fatal:!0};var ie={},se={},ae=function(){return ae=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ae.apply(this,arguments)};function ue(e){return e.toLowerCase()}"function"==typeof SuppressedError&&SuppressedError;var ce=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],le=/[^A-Z0-9]+/gi;function de(e,t,n){return t instanceof RegExp?e.replace(t,n):t.reduce((function(e,t){return e.replace(t,n)}),e)}function fe(e,t){var n=e.charAt(0),r=e.substr(1).toLowerCase();return 0>=t||"0">n||n>"9"?""+n.toUpperCase()+r:"_"+n+r}function pe(e,t){return void 0===t&&(t={}),function(e,t){void 0===t&&(t={});for(var n=t.splitRegexp,r=t.stripRegexp,o=void 0===r?le:r,i=t.transform,s=void 0===i?ue:i,a=t.delimiter,u=void 0===a?" ":a,c=de(de(e,void 0===n?ce:n,"$1\0$2"),o,"\0"),l=0,d=c.length;"\0"===c.charAt(l);)l++;for(;"\0"===c.charAt(d-1);)d--;return c.slice(l,d).split("\0").map(s).join(u)}(e,ae({delimiter:"",transform:fe},t))}function he(e,t){return 0===t?e.toLowerCase():fe(e,t)}var ve,ge,me=t(Object.freeze({__proto__:null,camelCase:function(e,t){return void 0===t&&(t={}),pe(e,ae({transform:he},t))},camelCaseTransform:he,camelCaseTransformMerge:function(e,t){return 0===t?e.toLowerCase():function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}(e)}}));function ye(){if(ve)return se;ve=1;var e=me;function t(){if("undefined"!=typeof window&&window.tracking&&tracking._prot)return window.tracking}return se.statistHandlerFactory=function({statistClient:n}){return"undefined"!=typeof window&&(window.__eventeaStatistSignedPayload=!0),({event:r,payload:o,project:i,config:s,handlersData:a})=>{var u;let c=o||{};if(!function(e){return"object"==typeof e&&null!==e}(s))throw new Error("Unknown config for statist handler");{const o=`eventea.projects.${e.camelCase(i)}`,l=s.fullName||r,d=t(),f=a&&a.statist?a.statist:void 0;if(f&&f.commonParams&&d){const e={};for(const t of Object.keys(f.commonParams)){const{deprecated:n}=f.commonParams[t];!n&&t in d._prot.dataPool&&(e[t]=d._prot.dataPool[t])}c={...d._prot.collectDataElements(e),...c}}c.eventea=!0,n.send(o,l,c);const p=null===(u=s.userProperties)||void 0===u?void 0:u.increment;p&&n.updateUserProperties(o,"increment",p)}}},se}function be(){return ge||(ge=1,ie.statistHandlerFactory=ye().statistHandlerFactory),ie}var Se=be();const we=[];for(let e=0;256>e;++e)we.push((e+256).toString(16).slice(1));function Ee(e,t=0){return(we[e[t+0]]+we[e[t+1]]+we[e[t+2]]+we[e[t+3]]+"-"+we[e[t+4]]+we[e[t+5]]+"-"+we[e[t+6]]+we[e[t+7]]+"-"+we[e[t+8]]+we[e[t+9]]+"-"+we[e[t+10]]+we[e[t+11]]+we[e[t+12]]+we[e[t+13]]+we[e[t+14]]+we[e[t+15]]).toLowerCase()}let je;const ke=new Uint8Array(16);function _e(){if(!je){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");je=crypto.getRandomValues.bind(crypto)}return je(ke)}var Pe={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ce(e,t,n){if(Pe.randomUUID&&!e)return Pe.randomUUID();const r=(e=e||{}).random||(e.rng||_e)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,Ee(r)}const Me={};function Oe(e,t,n){let r;{const e=Date.now(),o=_e();!function(e,t,n){e.msecs??=-1/0,e.seq??=0,t>e.msecs?(e.seq=n[6]<<23|n[7]<<16|n[8]<<8|n[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++)}(Me,e,o),r=function(e,t,n,r,o=0){r||(r=new Uint8Array(16),o=0);return t??=Date.now(),n??=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9],r[o++]=t/1099511627776&255,r[o++]=t/4294967296&255,r[o++]=t/16777216&255,r[o++]=t/65536&255,r[o++]=t/256&255,r[o++]=255&t,r[o++]=112|n>>>28&15,r[o++]=n>>>20&255,r[o++]=128|n>>>14&63,r[o++]=n>>>6&255,r[o++]=n<<2&255|3&e[10],r[o++]=e[11],r[o++]=e[12],r[o++]=e[13],r[o++]=e[14],r[o++]=e[15],r}(o,Me.msecs,Me.seq,t,n)}return t?r:Ee(r)}var Re,De,Te=function(){return Te=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Te.apply(this,arguments)},He=function(e){return null!==e&&"object"==typeof e};!function(e){e[e.Essential=1]="Essential",e[e.Functionality=2]="Functionality",e[e.Statistics=4]="Statistics",e[e.Marketing=8]="Marketing"}(Re||(Re={})),function(e){e[e.PersonalDataProcessing=16]="PersonalDataProcessing"}(De||(De={}));var Ae=/^\d+(0|s|t)\d+$/,Ie=["internal_source"],Le=0xfffffffffffff,xe={Essential:Re.Essential,Functionality:Re.Functionality,Statistics:Re.Statistics,Marketing:Re.Marketing,PersonalDataProcessing:De.PersonalDataProcessing};function Ue(e,t){for(var n={},r=0,o=e;o.length>r;r++){var i=o[r];i in t&&(n[i]=t[i])}return n}var qe=function(){function e(e){this.clear=this.getSafeVersionOfMethod("clear",void 0),this.key=this.getSafeVersionOfMethod("key",null),this.setItem=this.getSafeVersionOfMethod("setItem",void 0),this.getItem=this.getSafeVersionOfMethod("getItem",null),this.removeItem=this.getSafeVersionOfMethod("removeItem",void 0),this.storageType=e}return Object.defineProperty(e.prototype,"length",{get:function(){try{return this.storage.length}catch(e){}return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"storage",{get:function(){if(!this.storageImpl){var e={local:localStorage,session:sessionStorage};this.storageImpl=e[this.storageType]}return this.storageImpl},enumerable:!1,configurable:!0}),e.prototype.getSafeVersionOfMethod=function(e,t){var n=this;return function(){for(var r,o=[],i=0;arguments.length>i;i++)o[i]=arguments[i];try{return(r=n.storage)[e].apply(r,o)}catch(e){}return t}},e}();new qe("local");var Ne=new qe("session");var $e,Be=5184e3,ze=Re.Marketing|Re.Statistics,Fe={utmSource:{name:"utm_source",category:ze,expires:Be,subdomains:!0},utmContent:{name:"utm_content",category:ze,expires:Be,subdomains:!0},utmCampaign:{name:"utm_campaign",category:ze,expires:Be,subdomains:!0},utmMedium:{name:"utm_medium",category:ze,expires:Be,subdomains:!0},utmTerm:{name:"utm_term",category:ze,expires:Be,subdomains:!0},utmDateSet:{name:"utm_date_set",category:ze,expires:Be,subdomains:!0},sid:{name:"sid",category:ze,expires:Be,subdomains:!0},wm:{name:"wm",category:ze,expires:Be,subdomains:!0}},Ve={ctxSource:{name:"ctx_source",category:ze,expires:Be,subdomains:!0},ctxPosition:{name:"ctx_position",category:ze,expires:Be,subdomains:!0},ctxBlock:{name:"ctx_block",category:ze,expires:Be,subdomains:!0}};function Je(e,t){var n=function(e){void 0===e&&(e={});for(var t=function(e){return He(e)?Object.keys(e):[]}(e),n=t.length,r=new Array(n),o=0;n>o;o++)r[o]=[t[o],e[t[o]]];return r}(t).map((function(t){var n=t[0],r=t[1];return"string"!=typeof r?[n,r]:[n,Qe(r,n in e?e[n]:e.default)]}));return function(e){void 0===e&&(e=[]);for(var t={},n=0;e.length>n;n++)t[e[n][0]]=e[n][1];return t}(n)}function Qe(e,t){var n=e;return n.length>255&&(n=function(e){return e.slice(0,251)}(n)),encodeURIComponent(n).length>t&&(n=function(e,t){for(var n=0,r=e.length+1;r>n+1;){var o=Math.floor((n+r)/2);encodeURIComponent(e.slice(0,o)).length>t?r=o:n=o}return e.slice(0,n)}(n,t-4)),n===e?e:"".concat(n).concat(".cut")}var We,Ge=(($e={})[Fe.utmSource.name]=255,$e.session_utm_source=255,$e[Fe.utmTerm.name]=600,$e[Fe.utmContent.name]=600,$e[Fe.utmCampaign.name]=255,$e[Fe.utmMedium.name]=255,$e[Fe.sid.name]=140,$e[Fe.wm.name]=100,$e),Ke=Te(Te({},Ge),{default:72});!function(e){e.source="source",e.position="position",e.block="block"}(We||(We={}));var Ze="session_utm_source",Xe=[Fe.utmSource,Fe.utmContent,Fe.utmCampaign,Fe.utmMedium,Fe.utmTerm,Fe.sid,Fe.wm],Ye=[Ve.ctxPosition,Ve.ctxBlock,Ve.ctxSource];function et(e){var t,n,r=e.cookies,o=e.location,i=e.referrer,s=e.parseUrl,a=e.internalDomains,u=Xe.map((function(e){return e.name})),c=Ye.map((function(e){return e.name})),l=o.query.parent_url,d=l?s(l):void 0,f=o.query.utm_source||!d?o.query:d.query,p=o.hash.replace("#",""),h=p?function(e,t,n){void 0===t&&(t="&"),void 0===n&&(n="=");for(var r={},o=0,i=e.split(t);i.length>o;o++){var s=String(i[o]).split(n),a=s[0],u=s.slice(1);if(a){var c=u.join(n);try{c=decodeURIComponent(c)}catch(e){}r[decodeURIComponent(a)]=c}}return r}(p):{},v=Ue(Ie,f),g=Ue(u,f),m=Ue(u,h),y=function(e){switch(!0){case function(e){return null==e}(e):return!0;case function(e){return"string"==typeof e||e instanceof String}(e):return""===e;case function(e){return!!e&&Array.isArray(e)}(e):return 0===e.length;case He(e):return 0===Object.keys(e).length}return!1}(g)?m:g;function b(e,t){for(var n=0,o=e;o.length>n;n++){var i=o[n],s=t[i.name];s?r.set(i,s):r.remove(i.name,!0)}}function S(e){return Ue(e,r.getAll())}function w(){return Te({internal_source:""},v)}var E=!1,j=!1;return function(){var e,s,c,l,d;if(y.utm_source)return t=Te(Te({collectionMethod:"get",cookieDate:Date.now(),utm_source:"",session_utm_source:y.utm_source||""},w()),y),n=function(){var e=f[We.position];if("string"!=typeof e)return{};var t,n={};return Ae.test(e)?(t=e.split(/\D/),n.ctx_position=t.length>1?t[1]:"",n.ctx_block=t[0]+e.replace(/\d/g,"")):(n.ctx_position=e,n.ctx_block=f[We.block]),n.ctx_source=f[We.source]||"",n}(),void(E=!0);if(s=S(u),c=Number(r.get("utm_date_set"))||null,l=Ne.getItem(Ze)||"",d=null,s.utm_source&&(d="cookie"),t=Te(Te({collectionMethod:d,cookieDate:c,utm_source:"",session_utm_source:l},w()),s),i&&function(e,t,n){return void 0===n&&(n=[]),e!==t&&[e,t].some((function(e){return n.every((function(t){return e!==t&&!e.endsWith(".".concat(t))}))}))}(o.hostname,i,a)){var p,h=null===(e=t.utm_source)||void 0===e?void 0:e.includes(".");if(!t.utm_source||h)return t=Te({utm_source:p=i,session_utm_source:p,collectionMethod:"referrer",cookieDate:Date.now()},w()),n={},void(E=!0);t.session_utm_source||(t.session_utm_source=i,E=!0,j=!0)}}(),t=Je(Ke,t),n=Je(Ke,null!=n?n:{}),E&&function(e,t,n){void 0===n&&(n=!1),n||(r.set(Fe.utmDateSet,e.cookieDate||Date.now()),b(Xe,e),b(Ye,t||{})),e.session_utm_source&&Ne.setItem(Ze,e.session_utm_source)}(t,n,j),n&&(n=S(c)),Te(Te({},n),{utmMarkers:t})}var tt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0,nt=tt.document,rt=tt.window,ot=tt.navigator,it=tt.XMLHttpRequest;function st(e,t){var n={},r=function(t,n){e.set(t.name,n,t.expires,t.subdomains)};return t.on("update",(function(){for(var e=0,o=Object.keys(n);o.length>e;e++){var i=o[e],s=n[i],a=s.cookie,u=s.value;t.isAllowed(a.category)&&(r(a,u),delete n[i])}})),{get:function(t){return e.get(t)},getAll:function(){return e.getAll()},set:function(e,o){var i=t.isAllowed(e.category);return i?r(e,o):n[e.name]={cookie:e,value:o},i},remove:function(t,r){delete n[t],e.remove(t,r)}}}function at(e){void 0===e&&(e={});var t,n=e.defaults,r=void 0===n?Le:n,o=e.alwaysEnabled,i=void 0===o?Re.Essential:o,s=r,a=(t=t||Object.create(null),{on:function(e,n){(t[e]||(t[e]=[])).push(n)},off:function(e,n){t[e]&&t[e].splice(t[e].indexOf(n)>>>0,1)},emit:function(e){var n=[].slice.call(arguments,1);(t[e]||[]).map((function(e){e.apply(void 0,n)})),(t["*"]||[]).map((function(t){t.apply(void 0,[e].concat(n))}))}});return Object.assign(a,{once:function(e,t){var n=function(){a.off(e,n),t()};a.on(e,n)},isAllowed:function(e){return(this.getAllowedMask()&e)===e},resetAllTo:function(e){s=e,a.emit("update")},update:function(e,t){void 0===t&&(t="keep"),"enable"===t?s|=Le:"disable"===t&&(s=0);for(var n=0,r=Object.keys(e);r.length>n;n++){var o=Number(r[n]);e[o]?s|=o:s&=~o}a.emit("update")},getAllowedMask:function(){return(null!=s?s:r)|i},categories:xe})}var ut,ct,lt,dt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0,ft=dt.document,pt=dt.window,ht=function(e,t){return ht=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},ht(e,t)},vt=function(){return vt=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},vt.apply(this,arguments)};!function(e){e[e.Essential=1]="Essential",e[e.Functionality=2]="Functionality",e[e.Statistics=4]="Statistics",e[e.Marketing=8]="Marketing"}(ut||(ut={})),function(e){e[e.PersonalDataProcessing=16]="PersonalDataProcessing"}(ct||(ct={}));var gt=((lt={}).utm_source=255,lt.session_utm_source=255,lt.utm_term=600,lt.utm_content=600,lt.utm_campaign=255,lt.utm_medium=255,lt.sid=140,lt.wm=100,lt),mt=vt(vt({},gt),{default:72}),yt=/^(?:::(?:ffff:(0:)?)?)?(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/,bt=/^([0-9a-fA-F]{1,4}:){1,4}:(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;var St=function(){function e(e,t){this.limits=e,this.logger=t,this.isCookieAvailable=null,this.hasSamesiteNoneSupport=null,this.localState=Object.create(null)}return e.prototype.get=function(e){return this.checkCookieAvailability()?this.getCookie(e):this.getLocalState(e)},e.prototype.getAll=function(){return this.checkCookieAvailability()?this.getAllCookies():this.getAllLocalState()},e.prototype.set=function(e,t,n,r){this.checkCookieAvailability()&&this.setCookie(e,t,n,r),this.setLocalState(e,t)},e.prototype.remove=function(e,t){this.checkCookieAvailability()?this.removeCookie(e,t):this.removeLocalState(e)},e.prototype.checkCookieAvailability=function(){if(null!=this.isCookieAvailable)return this.isCookieAvailable;if(null==ft.cookie)return this.isCookieAvailable=!1,this.isCookieAvailable;var e="test_cookie_sqJPwCiceI";ft.cookie="".concat(e,"=true");var t=this.getCookie(e);return this.isCookieAvailable="true"===t,ft.cookie="".concat(e,"=; expires=").concat(new Date(0).toUTCString()),this.isCookieAvailable},e.prototype.checkSamesiteNoneSupport=function(){if(null!=this.hasSamesiteNoneSupport)return this.hasSamesiteNoneSupport;if(!this.checkCookieAvailability())return this.hasSamesiteNoneSupport=!1,this.hasSamesiteNoneSupport;var e="test_cookie_yIKsyPp4Fh";ft.cookie="".concat(e,"=true; samesite=none; secure");var t=this.getCookie(e);return this.hasSamesiteNoneSupport="true"===t,ft.cookie="".concat(e,"=; expires=").concat(new Date(0).toUTCString()),this.hasSamesiteNoneSupport},e.prototype.getCookie=function(e){var t=this.getRawCookie(e);return t?decodeURIComponent(t):null},e.prototype.getAllCookies=function(){return function(e){void 0===e&&(e={});for(var t=function(e){return null!==(t=e)&&"object"==typeof t?Object.keys(e):[];var t}(e),n=t.length,r=new Array(n),o=0;n>o;o++)r[o]=[t[o],e[t[o]]];return r}(this.getAllRawCookies()).reduce((function(e,t){return e[t[0]]=decodeURIComponent(t[1]),e}),{})},e.prototype.setCookie=function(e,t,n,r){var o;void 0===n&&(n="session"),void 0===r&&(r=!1);try{!function(e,t,n){var r=encodeURIComponent(n),o=e[t]||e.default;if(r.length>o)throw new Error("ECookieTooLarge: cookie ".concat(t," exceeds maximum length of ").concat(o," bytes"))}(this.limits,e,String(t))}catch(e){return void(null===(o=this.logger)||void 0===o||o.error(e))}var i=[];if(i.push("".concat(e,"=").concat(encodeURIComponent(t)),"path=/","domain=".concat(r?function(e){return yt.test(t=e)||bt.test(t)?e:0>e.indexOf("localhost")?".".concat(e.split(".").slice(-2).join(".")):"localhost";var t}(pt.location.hostname):pt.location.hostname)),"session"!==n){var s=0===n?new Date(0):new Date(Date.now()+1e3*n);i.push("expires=".concat(s.toUTCString()))}this.checkSamesiteNoneSupport()&&i.push("samesite=none","secure"),ft.cookie=i.join("; ")},e.prototype.removeCookie=function(e,t){null!==this.getCookie(e)&&this.setCookie(e,"",0,t)},e.prototype.getLocalState=function(e){return this.localState[e]||null},e.prototype.getAllLocalState=function(){return this.localState},e.prototype.setLocalState=function(e,t){return this.localState[e]=t.toString(),t},e.prototype.removeLocalState=function(e){e in this.localState&&delete this.localState[e]},e.prototype.getRawCookie=function(e){return ft.cookie.split("; ").reduce((function(t,n){var r=n.split("=");return r[0]===e?r[1]:t}),"")||null},e.prototype.getAllRawCookies=function(){return ft.cookie.split("; ").reduce((function(e,t){var n=t.split("="),r=n[0];return r?(e[r]=n[1],e):e}),{})},e}(),wt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ht(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.get=function(t){try{return e.prototype.get.call(this,t)}catch(n){return e.prototype.getRawCookie.call(this,t)}},t.prototype.getAll=function(){try{return e.prototype.getAll.call(this)}catch(t){return e.prototype.getAllRawCookies.call(this)}},t}(St);function Et(e){var t=ft.createElement("a");return t.href=e,function(e){void 0===e&&(e=ft.location);var t={get query(){return function(e,t,n){void 0===t&&(t="&"),void 0===n&&(n="=");for(var r={},o=0,i=e.split(t);i.length>o;o++){var s=String(i[o]).split(n),a=s[0],u=s.slice(1);if(a){var c=u.join(n);try{c=decodeURIComponent(c)}catch(e){}r[decodeURIComponent(a)]=c}}return r}(e.search.slice(1))},get pathname(){return"/"!==e.pathname.charAt(0)?"/".concat(e.pathname):e.pathname}};return["hash","host","hostname","href","port","protocol","search","origin"].forEach((function(n){Object.defineProperty(t,n,{get:function(){return e[n]},set:function(t){"origin"!==n&&(e[n]=t)},enumerable:!0})})),t}(t)}new wt(mt);var jt,kt,_t,Pt,Ct,Mt,Ot=["tinkoff.ru","tinkoffinsurance.ru","dolyame.ru","tbank.ru"];function Rt(){if(kt)return jt;kt=1;var e=/([a-z])([A-Z])/g,t=/[^a-zA-Z]+/g;return jt=function(n){return n.replace(e,(function(e,t,n){return t+" "+n})).split(t)}}function Dt(){if(Pt)return _t;return Pt=1,_t=function(e){return""+e.charAt(0).toUpperCase()+e.slice(1)}}function Tt(){if(Mt)return Ct;Mt=1;var e=Rt(),t=Dt();return Ct=function(n){return e(n).map((function(e,n){return 0===n?e.toLowerCase():t(e.toLowerCase())})).join("")}}var Ht,At,It,Lt,xt=e(Tt());function Ut(){return At||(At=1,Ht=function(e,t){return function n(){for(var r=arguments.length,o=new Array(r),i=0;r>i;i++)o[i]=arguments[i];return e>o.length?function(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];return n.apply(this,o.concat(t))}:t.apply(this,o)}}),Ht}function qt(){if(Lt)return It;Lt=1;return It=Ut()(2,(function(e,t){void 0===e&&(e=[]),void 0===t&&(t={});for(var n=t,r=0;e.length>r;r++){if(null==n)return;n=n[e[r]]}return n})),It}var Nt,$t,Bt=e(qt());function zt(){return $t?Nt:($t=1,Nt=Ut()(2,(function(e,t){return null!=t&&Object.prototype.hasOwnProperty.call(t,e)})))}var Ft,Vt={exports:{}},Jt={};var Qt,Wt,Gt,Kt,Zt,Xt,Yt,en,tn,nn,rn,on,sn,an,un,cn,ln,dn,fn={};function pn(){return Wt||(Wt=1,Vt.exports="production"===process.env.NODE_ENV?function(){if(Ft)return Jt;Ft=1;var e="function"==typeof Symbol&&Symbol.for,t=e?Symbol.for("react.element"):60103,n=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,o=e?Symbol.for("react.strict_mode"):60108,i=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,u=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,l=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,f=e?Symbol.for("react.suspense_list"):60120,p=e?Symbol.for("react.memo"):60115,h=e?Symbol.for("react.lazy"):60116,v=e?Symbol.for("react.block"):60121,g=e?Symbol.for("react.fundamental"):60117,m=e?Symbol.for("react.responder"):60118,y=e?Symbol.for("react.scope"):60119;function b(e){if("object"==typeof e&&null!==e){var f=e.$$typeof;switch(f){case t:switch(e=e.type){case u:case c:case r:case i:case o:case d:return e;default:switch(e=e&&e.$$typeof){case a:case l:case h:case p:case s:return e;default:return f}}case n:return f}}}function S(e){return b(e)===c}return Jt.AsyncMode=u,Jt.ConcurrentMode=c,Jt.ContextConsumer=a,Jt.ContextProvider=s,Jt.Element=t,Jt.ForwardRef=l,Jt.Fragment=r,Jt.Lazy=h,Jt.Memo=p,Jt.Portal=n,Jt.Profiler=i,Jt.StrictMode=o,Jt.Suspense=d,Jt.isAsyncMode=function(e){return S(e)||b(e)===u},Jt.isConcurrentMode=S,Jt.isContextConsumer=function(e){return b(e)===a},Jt.isContextProvider=function(e){return b(e)===s},Jt.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===t},Jt.isForwardRef=function(e){return b(e)===l},Jt.isFragment=function(e){return b(e)===r},Jt.isLazy=function(e){return b(e)===h},Jt.isMemo=function(e){return b(e)===p},Jt.isPortal=function(e){return b(e)===n},Jt.isProfiler=function(e){return b(e)===i},Jt.isStrictMode=function(e){return b(e)===o},Jt.isSuspense=function(e){return b(e)===d},Jt.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===c||e===i||e===o||e===d||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===h||e.$$typeof===p||e.$$typeof===s||e.$$typeof===a||e.$$typeof===l||e.$$typeof===g||e.$$typeof===m||e.$$typeof===y||e.$$typeof===v)},Jt.typeOf=b,Jt}():(Qt||(Qt=1,"production"!==process.env.NODE_ENV&&function(){var e="function"==typeof Symbol&&Symbol.for,t=e?Symbol.for("react.element"):60103,n=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,o=e?Symbol.for("react.strict_mode"):60108,i=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,u=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,l=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,f=e?Symbol.for("react.suspense_list"):60120,p=e?Symbol.for("react.memo"):60115,h=e?Symbol.for("react.lazy"):60116,v=e?Symbol.for("react.block"):60121,g=e?Symbol.for("react.fundamental"):60117,m=e?Symbol.for("react.responder"):60118,y=e?Symbol.for("react.scope"):60119;function b(e){if("object"==typeof e&&null!==e){var f=e.$$typeof;switch(f){case t:var v=e.type;switch(v){case u:case c:case r:case i:case o:case d:return v;default:var g=v&&v.$$typeof;switch(g){case a:case l:case h:case p:case s:return g;default:return f}}case n:return f}}}var S=c,w=a,E=s,j=t,k=l,_=r,P=h,C=p,M=n,O=i,R=o,D=d,T=!1;function H(e){return b(e)===c}fn.AsyncMode=u,fn.ConcurrentMode=S,fn.ContextConsumer=w,fn.ContextProvider=E,fn.Element=j,fn.ForwardRef=k,fn.Fragment=_,fn.Lazy=P,fn.Memo=C,fn.Portal=M,fn.Profiler=O,fn.StrictMode=R,fn.Suspense=D,fn.isAsyncMode=function(e){return T||(T=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),H(e)||b(e)===u},fn.isConcurrentMode=H,fn.isContextConsumer=function(e){return b(e)===a},fn.isContextProvider=function(e){return b(e)===s},fn.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===t},fn.isForwardRef=function(e){return b(e)===l},fn.isFragment=function(e){return b(e)===r},fn.isLazy=function(e){return b(e)===h},fn.isMemo=function(e){return b(e)===p},fn.isPortal=function(e){return b(e)===n},fn.isProfiler=function(e){return b(e)===i},fn.isStrictMode=function(e){return b(e)===o},fn.isSuspense=function(e){return b(e)===d},fn.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===c||e===i||e===o||e===d||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===h||e.$$typeof===p||e.$$typeof===s||e.$$typeof===a||e.$$typeof===l||e.$$typeof===g||e.$$typeof===m||e.$$typeof===y||e.$$typeof===v)},fn.typeOf=b}()),fn)),Vt.exports}function hn(){if(Kt)return Gt;Kt=1;var e,t=zt();try{e=pn().isElement}catch(e){}return e||(e=function(e){return!!e&&t("$$typeof",e)}),Gt=e}function vn(){if(Xt)return Zt;Xt=1;var e,t=zt();try{e=pn().isValidElementType}catch(e){}return e||(e=function(e){return"string"==typeof e||"function"==typeof e||!!e&&t("$$typeof",e)}),Zt=e}function gn(){return en?Yt:(en=1,Yt=function(e){return null!==e&&"object"==typeof e})}function mn(){if(nn)return tn;nn=1;var e=hn(),t=vn(),n=gn();return tn=function(r){if(!n(r))return!1;var o=Object.getPrototypeOf(r);if(null===o)return!0;if(o!==Object.prototype)return!1;if(e(r)||t(r))return!1;return!0}}function yn(){if(on)return rn;on=1;var e=gn();return rn=function(t){return e(t)?Object.keys(t):[]}}function bn(){return an?sn:(an=1,sn=function(e){return!!e&&Array.isArray(e)})}function Sn(){if(cn)return un;cn=1;var e=bn();return un=function(){for(var t=arguments.length,n=new Array(t),r=0;t>r;r++)n[r]=arguments[r];return e(n[0])?Object.assign.apply(Object,[[]].concat(n)):Object.assign.apply(Object,[{}].concat(n))},un}function wn(){if(dn)return ln;dn=1;var e=Ut(),t=mn(),n=yn(),r=Sn();return ln=e(2,(function e(){for(var o=r((arguments.length>0?arguments[0]:void 0)||{}),i=1;arguments.length>i;i++){var s=0>i||i>=arguments.length?void 0:arguments[i];if(s)for(var a=n(s),u=0;a.length>u;u++){var c=a[u],l=s[c],d=o[c];o[c]=t(d)&&t(l)?e(d,l):l}}return o})),ln}var En=e(wn()),jn=function(e,t){return jn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},jn(e,t)};function kn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}jn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var _n=function(){return _n=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},_n.apply(this,arguments)};function Pn(e,t,n,r){return new(n||(n=Promise))((function(t,o){function i(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(e){e(r)}))).then(i,s)}a((r=r.apply(e,[])).next())}))}function Cn(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&o[3]>i[1])){s.label=i[1];break}if(6===i[0]&&o[1]>s.label){s.label=o[1],o=i;break}if(o&&o[2]>s.label){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function Mn(e,t,n){for(var r,o=0,i=t.length;i>o;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||t)}var On=function(){var e=0;return function(){return{clientEventTimestamp:Date.now(),clientUploadTimestamp:Date.now(),sequence:++e,uuid:Ce()}}},Rn=15768e4,Dn={sessionId:{name:"vIdUid",category:Re.Essential,expires:Rn,subdomains:!0},wuid:{name:"__P__wuid",category:Re.Essential,expires:Rn,subdomains:!0},webviewWuid:{name:"deviceId",category:Re.Essential},deviceId:{name:"stDeIdU",category:Re.Essential,expires:Rn,subdomains:!0},lastEventTime:{name:"stLaEvTi",category:Re.Essential,expires:Rn,subdomains:!0},sessionStartTime:{name:"stSeStTi",category:Re.Essential,expires:Rn,subdomains:!0}},Tn=function(e){return"object"==typeof e&&null!==e&&"string"==typeof e.sessionId&&"number"==typeof e.sessionStartTime},Hn=function(e){if("string"!=typeof e)return!1;var t=e.split(".");return 2===t.length&&"1"===t[0]},An=function(){function e(){var e,t,n=this;this.version=null,this.sessionInfo=null,void 0!==(null===(t=null===(e=window.webkit)||void 0===e?void 0:e.messageHandlers)||void 0===t?void 0:t.statistNativeSdk)&&(rt._statistIosSdkRecipient=function(e,t){"getVersion"===e?n.version="string"==typeof t?t:null:"getSessionInfo"===e&&Tn(t)&&(n.sessionInfo=t)},this.refreshVersion(),this.refreshSession(),setInterval((function(){n.refreshSession()}),1e4))}return e.prototype.isConnected=function(){return Hn(this.version)},e.prototype.getSessionInfo=function(){return this.sessionInfo},e.prototype.notifyEventHappened=function(){var e,t,n;null===(n=null===(t=null===(e=rt.webkit)||void 0===e?void 0:e.messageHandlers)||void 0===t?void 0:t.statistNativeSdk)||void 0===n||n.postMessage("notifyEventHappened")},e.prototype.refreshVersion=function(){var e,t,n;null===(n=null===(t=null===(e=rt.webkit)||void 0===e?void 0:e.messageHandlers)||void 0===t?void 0:t.statistNativeSdk)||void 0===n||n.postMessage("getVersion")},e.prototype.refreshSession=function(){var e,t,n;null===(n=null===(t=null===(e=rt.webkit)||void 0===e?void 0:e.messageHandlers)||void 0===t?void 0:t.statistNativeSdk)||void 0===n||n.postMessage("getSessionInfo")},e}(),In=function(){function e(){}return e.prototype.isConnected=function(){return void 0!==rt._statistAndroidSdkBridge&&Hn(rt._statistAndroidSdkBridge.getVersion())},e.prototype.parseSession=function(e){try{var t=JSON.parse(e);return Tn(t)?t:null}catch(e){return null}},e.prototype.getSessionInfo=function(){var e,t=null===(e=rt._statistAndroidSdkBridge)||void 0===e?void 0:e.getSessionInfo();return t?this.parseSession(t):null},e.prototype.notifyEventHappened=function(){var e;null===(e=rt._statistAndroidSdkBridge)||void 0===e||e.notifyEventHappened()},e}(),Ln=function(){function e(){this.bridges=[],this.connectedBridge=null;var e=rt._statistNativeBridges||(rt._statistNativeBridges={}),t=e[1];if(t)return this.bridges=t.bridges,void(this.connectedBridge=t.connectedBridge);this.bridges=[new In,new An],e[1]=this}return e.prototype.getConnectedBridge=function(){var e;return null===this.connectedBridge&&(this.connectedBridge=null!==(e=this.bridges.find((function(e){return e.isConnected()})))&&void 0!==e?e:null),this.connectedBridge},e.prototype.getSessionInfo=function(){var e,t;return null!==(t=null===(e=this.getConnectedBridge())||void 0===e?void 0:e.getSessionInfo())&&void 0!==t?t:null},e.prototype.notifyEventHappened=function(){var e;null===(e=this.getConnectedBridge())||void 0===e||e.notifyEventHappened()},e}(),xn=function(){return rt.statistQueue=rt.statistQueue||[],rt.statistQueue};function Un(){var e=Et(rt.location.href),t=function(e){var t=e.referrer,n="";return t&&t.hostname!==e.locationHostname&&(n=t.hostname),n}({referrer:ft.referrer?Et(ft.referrer):void 0,locationHostname:e.hostname});return function(e){return["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].reduce((function(t,n){var r,o=e[n];return o&&(t[(r=n,xt(r))]=o),t}),{})}(et({cookies:st(new wt(Ke),at()),location:e,referrer:t,parseUrl:Et,internalDomains:Ot}).utmMarkers)}function qn(){var e,t;if(function(){try{return window.self!==window.top}catch(e){return!0}}()){var n=rt.location.href;t=null!==(e=Et(n).query.parent_url)&&void 0!==e?e:n}else t=rt.location.href;return function(e){return e.hostname+e.pathname}(Et(t))}var Nn=function(){function e(){var e=this;this.currentUrl=null,this.previousUrl=null,this.isPageReloaded=null,this.updateLocation=function(){var t=Et(e.currentUrl);rt.location.hostname===t.hostname&&rt.location.pathname===t.pathname||(e.isPageReloaded=!1,e.previousUrl=e.currentUrl,e.currentUrl=rt.location.href)},this.runListeners=function(){var e;null===(e=rt._statistLocationChangeListeners)||void 0===e||e.forEach((function(e){return e()}))},this.init()}return e.prototype.init=function(){var e=this;this.initLocation(),window.addEventListener("_statist-location-change",(function(){setTimeout(e.updateLocation)})),this.subscribeHistory()},e.prototype.resolve=function(){var e=Et(rt.location.href),t=this.previousUrl?Et(this.previousUrl):void 0,n=this.isPageReloaded?e:t;if(n)return function(e){return e.split("?")[0]}(n.href)},e.prototype.initLocation=function(){this.previousUrl=nt.referrer,this.currentUrl=rt.location.href,this.isPageReloaded=1===Bt(["performance","navigation","type"],rt)},e.prototype.subscribeHistory=function(){var e,t=this;if(Boolean("undefined"!=typeof window&&(null===(e=window.history)||void 0===e?void 0:e.pushState)))if(Array.isArray(rt._statistLocationChangeListeners))rt._statistLocationChangeListeners.push(this.updateLocation);else{rt._statistLocationChangeListeners=[this.updateLocation];var n=window.history.pushState;window.history.pushState=function(){for(var e=[],r=0;arguments.length>r;r++)e[r]=arguments[r];setTimeout(t.runListeners),n.apply(window.history,e)},window.addEventListener("popstate",(function(){setTimeout(t.runListeners)}))}},e}(),$n=function(){function e(){this.listeners=Object.create(null)}return e.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.off=function(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((function(e){return e!==t})))},e.prototype.emit=function(e){for(var t=[],n=1;arguments.length>n;n++)t[n-1]=arguments[n];var r=this.listeners[e];if(r)for(var o=0,i=r;i.length>o;o++)i[o].apply(void 0,t)},e}(),Bn=st(new St(Ke),at()),zn=/^[0-9a-f]{16}$/,Fn=/^[0-9a-f]{32}$/,Vn=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/,Jn=function(e){var t,n,r;if((r="cookies"===e.from?e.isWebview?null!==(n=null===(t=Bn.get(Dn.webviewWuid.name))||void 0===t?void 0:t.toLowerCase())&&void 0!==n?n:null:Bn.get(Dn.wuid.name):new URLSearchParams(rt.location.search).get("wuid"))&&function(e){return zn.test(e)||Fn.test(e)||Vn.test(e)}(r))return r},Qn=function(e){return"function"==typeof e?e():e},Wn={test:atob("aHR0cHM6Ly9hcGktc3RhdGlzdC5kZXYtdGNzZ3JvdXAuaW8="),prod:"https://api-statist.tinkoff.ru"},Gn="__statist_saved_messages",Kn=function(e){try{return rt.localStorage.getItem(e)}catch(e){return null}},Zn=function(){var e=Kn(Gn);if(null===e)return[];try{return JSON.parse(e)}catch(e){return[]}},Xn=function(){return function(e){try{return rt.localStorage.removeItem(e),!0}catch(e){return!1}}(Gn)},Yn=function(){function e(e,t){var n,r,o=this;this.timer=null,this.eventEmitter=new $n,this.destroy=function(){nt.removeEventListener("visibilitychange",o.handleVisibilityChange),rt.removeEventListener("pagehide",o.handlePageHide)},this.handleVisibilityChange=function(){"hidden"===nt.visibilityState?o.sendByBeacon():o.processSavedMessages()},this.handlePageHide=function(){o.sendByBeacon()},this.pushEventsUrl="".concat(e,"/gateway/v1/events"),this.batchSize=t.batchSize,this.pushInterval=t.pushInterval,this.pushTimeout=null!==(n=t.pushTimeout)&&void 0!==n?n:t.pushInterval,this.savedMessagesSize=t.savedMessagesSize,this.eventsJsonSizeLimit=t.eventsJsonSizeLimit,this.gzipDisabled=!("true"===Kn("_statist_enable_gzip")),this.apiKey=null!==(r=t.apiKey)&&void 0!==r?r:"","visibilityState"in nt&&nt.addEventListener("visibilitychange",this.handleVisibilityChange,!1),rt.addEventListener("pagehide",this.handlePageHide,!1),this.events=this.excludeOutdatedMessages(Zn()),this.sequence=this.getMaxSequence(this.events),this.events.length>0&&(Xn(),this.startPush())}return e.prototype.handleApiError=function(e){var t,n,r=this;if(200>e.status||e.status>=500)return this.saveMessages(e.events),void this.startPush();if(e.response)try{var o=JSON.parse(e.response);if(o.message&&(null===(t=o.details)||void 0===t?void 0:t.errors))return void o.details.errors.forEach((function(t){t&&r.eventEmitter.emit("error",Object.assign(new Error(o.message),{status:e.status,response:t}))}))}catch(e){}this.eventEmitter.emit("error",Object.assign(new Error(null!==(n=e.response)&&void 0!==n?n:e.message),{status:e.status}))},e.prototype.saveMessages=function(e){if(0===e.length)return!0;var t=Mn(Mn([],Zn()),e);t.length>this.savedMessagesSize&&t.splice(0,t.length-this.savedMessagesSize);return function(e){try{return function(e,t){try{return rt.localStorage.setItem(e,t),!0}catch(e){return!1}}(Gn,JSON.stringify(e))}catch(e){return!1}}(t)},e.prototype.excludeOutdatedMessages=function(e){var t=Date.now();return e.filter((function(e){return 5184e6>t-e.eventParameters.clientEventTimestamp}))},e.prototype.processSavedMessages=function(){this.events=Mn(Mn([],Zn()),this.events),this.events.length>0&&(Xn(),this.sequence=this.getMaxSequence(this.events),this.startPush())},e.prototype.getEventsJsonSize=function(){var e=JSON.stringify(this.events);return new Blob([e]).size},e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.startPush=function(){var e=this;if(0!==this.events.length){var t=function(t){return(e.isReady()?e.pushEvents(t):Promise.resolve()).then((function(){e.timer=null,e.startPush()}),(function(t){e.timer=null,e.handleApiError(t)}))};this.getEventsJsonSize()<this.eventsJsonSizeLimit?this.timer||(this.timer=setTimeout((function(){return t(e.batchSize)}),this.pushInterval)):t(this.events.length)}},e.prototype.pushEvents=function(e){return Pn(this,0,void 0,(function(){var t;return Cn(this,(function(n){return t=this.events.splice(0,e),[2,this.sendByXhr(t)]}))}))},e.prototype.updateTimestamp=function(e){for(var t=Date.now(),n=0,r=e;r.length>n;n++)r[n].eventParameters.clientUploadTimestamp=t},e.prototype.updateSequence=function(e){e.eventParameters.sequence=++this.sequence},e.prototype.getMaxSequence=function(e){var t=0;return e.forEach((function(e){var n=e.eventParameters.sequence;n>t&&(t=n)})),t},e.prototype.sendByXhr=function(e){var t=this;return it?e.length?(this.updateTimestamp(e),new Promise((function(n,r){var o=new it,i=function(){if(o.status<200||204<o.status){var t=Object.assign(new Error(o.responseText),{status:o.status,response:o.responseText,events:e});r(t)}else n()};o.onerror=i,o.onload=i,o.ontimeout=i,o.timeout=t.pushTimeout;var s=JSON.stringify(e);t.gzipDisabled?t.sendEventsJSON(s,o):t.sendEventsGZip(s,o)}))):Promise.resolve():Promise.reject()},e.prototype.sendEventsJSON=function(e,t){t.open("POST",this.pushEventsUrl,!0),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),this.apiKey&&t.setRequestHeader("X-Api-Key",this.apiKey),t.send(e)},e.prototype.sendEventsGZip=function(e,t){var n=this;(function(e){return Pn(void 0,0,void 0,(function(){return Cn(this,(function(t){return[2,Promise.resolve().then((function(){return new Blob([e],{type:"application/json"}).stream().pipeThrough(new rt.CompressionStream("gzip"))})).then((function(e){return new Response(e)})).then((function(e){return e.blob()}))]}))}))})(e).then((function(e){try{t.open("POST",n.pushEventsUrl,!0),t.setRequestHeader("Content-Type","application/gzip"),t.setRequestHeader("Content-Encoding","gzip"),n.apiKey&&t.setRequestHeader("X-Api-Key",n.apiKey),t.send(e)}catch(e){}})).catch((function(){n.sendEventsJSON(e,t)}))},e.prototype.sendByBeacon=function(){var e=this.events;this.events=[],e.length&&(ot.onLine?(this.updateTimestamp(e),ot.sendBeacon(this.pushEventsUrl,JSON.stringify(e))||this.saveMessages(e)):this.saveMessages(e))},e.prototype.forceSend=function(){this.sendByBeacon()},e.prototype.send=function(e){this.updateSequence(e),this.events.push(e),this.startPush()},e.prototype.isReady=function(){return!0},e}(),er=function(e){console.error(e)},tr=function(){function e(e,t,n,r){void 0===r&&(r=18e5),this.clientParameters=e,this.transport=t,this.eventParameters=n,this.sessionTimeout=r,this.nativeBridge=new Ln,this.deviceId=function(){var e,t="true"===new URLSearchParams(rt.location.search).get("iswebview"),n=Jn({from:"query"}),r=Jn({from:"cookies"}),o=Jn({from:"cookies",isWebview:t});return t&&o?Bn.set(Dn.wuid,e=o):n?(e=n,r&&!t||Bn.set(Dn.wuid,e)):e=r,e||(e=function(){var e="";if("undefined"!=typeof crypto){var t=Math.ceil(16),n=new Uint8Array(t);crypto.getRandomValues(n),n.forEach((function(t){e+=t.toString(16).padStart(2,"0")}))}else for(var r=0;32>r;r++)e+="0123456789abcdef".charAt(Math.floor(16*Math.random()));return e.substring(0,32)}(),Bn.set(Dn.wuid,e)),function(e){Bn.get(Dn.deviceId.name)!==e&&Bn.set(Dn.deviceId,e)}(e),e}(),this.screenWidth=rt.screen.width,this.screenHeight=rt.screen.height,this.codegenVersion="",this.eventEmitter=new $n,this.referrerResolver=new Nn,this.eventEmitter.on("message",(function(e){var t;!function(e){var t=xn();t.history||(t.history=[]),t.history.length>=1e3||t.history.push(e)}(e),(t=xn(),t.listeners||(t.listeners=[]),t.listeners).forEach((function(t){try{t(e)}catch(e){er(e)}}))}));var o,i,s=this.processStatistQueue.bind(this);o=s,(i=xn()).handlerApplied||(i.handlerApplied=!0,i.forEach((function(e){return o(e)})),i.length=0,i.push=function(){for(var e=[],t=0;arguments.length>t;t++)e[t]=arguments[t];return e.forEach((function(e){return o(e)})),0})}return e.prototype.processStatistQueue=function(e){try{if(!e||!Array.isArray(e))return;var t=e;switch(t[0]){case"getMessagesHistory":return void(0,t[1])((n=xn(),n.history||(n.history=[]),n.history));case"onMessage":!function(e){var t=xn();t.listeners||(t.listeners=[]),t.listeners.push(e)}(t[1])}}catch(e){er(e)}var n},e.createTransport=function(e){var t=e.apiKey,n=e.transportOptions||{},r=n.batchSize,o=void 0===r?100:r,i=n.pushInterval,s=void 0===i?5e3:i,a=n.pushTimeout,u=void 0===a?3e4:a,c=n.savedMessagesSize,l=void 0===c?1e3:c,d=n.eventsJsonSizeLimit,f=void 0===d?32e3:d,p=n.endpointUrl,h=void 0===p?Wn[e.environment||"prod"]:p,v=n.gzip,g=void 0===v||v,m=tt._statistTransports||(tt._statistTransports={});tt._statistTransport&&!m[Wn.prod]&&(m[Wn.prod]=tt._statistTransport),tt._statistDevTransport&&!m[Wn.test]&&(m[Wn.test]=tt._statistDevTransport);var y=m[h];if(y)return y;var b=new Yn(h,{apiKey:t,batchSize:o,pushInterval:s,pushTimeout:u,preconnect:!1,savedMessagesSize:l,eventsJsonSizeLimit:f,gzip:g});return m[h]=b,h===Wn.prod?tt._statistTransport=b:h===Wn.test&&(tt._statistDevTransport=b),b},e.prototype.getSessionId=function(){var e=this.nativeBridge.getSessionInfo();if(null!==e)return e.sessionId;var t=Bn.get(Dn.sessionId.name),n=Number(Bn.get(Dn.lastEventTime.name))||null;if(null!==t&&null!==n&&Date.now()-n<this.sessionTimeout)return t;var r=Oe();return Bn.set(Dn.sessionId,r),Bn.remove(Dn.lastEventTime.name,!0),Bn.remove(Dn.sessionStartTime.name,!0),r},e.prototype.getSessionStartTime=function(){var e=this.nativeBridge.getSessionInfo();return null!==e?e.sessionStartTime:null===Bn.get(Dn.sessionStartTime.name)?Date.now():Number(Bn.get(Dn.sessionStartTime.name))},e.prototype.resolveClientParameters=function(e){return _n(_n({},null!=e?e:this.clientParameters),{sessionId:this.getSessionId(),deviceId:this.deviceId,sessionStartTime:this.getSessionStartTime(),screenWidth:this.screenWidth,screenHeight:this.screenHeight,sdkVersion:"0.4.147",codegenVersion:this.codegenVersion})},e.prototype.resolveFullClientParameters=function(e){var t=this.referrerResolver.resolve();return _n(_n(_n(_n({},this.resolveClientParameters(e)),this.getUtmMarkers()),void 0!==t&&{referrer:t}),{pageUrl:qn()})},e.prototype.transportSend=function(e){this.transport.send(e),Bn.set(Dn.lastEventTime,Date.now()),this.nativeBridge.notifyEventHappened(),null===Bn.get(Dn.sessionStartTime.name)&&Bn.set(Dn.sessionStartTime,e.clientParameters.sessionStartTime)},e.prototype.sendUserProperties=function(e,t,n,r){var o,i,s=((o={kind:"userProperties",project:e,eventParameters:Qn(this.eventParameters),clientParameters:this.resolveClientParameters()})[n]=((i={})["$".concat(t)]=r,i),o);this.transportSend(s),this.eventEmitter.emit("message",{type:"userProperties",message:s})},e.prototype.send=function(e,t,n,r){var o={project:e,name:t,parameters:n,eventParameters:Qn(this.eventParameters),clientParameters:this.resolveFullClientParameters(r)};this.transportSend(o),this.eventEmitter.emit("message",{type:"event",message:o})},e.prototype.updateClientParameters=function(e){for(var t in e)this.clientParameters[t]=e[t]},e.prototype.updateUserProperties=function(e,t,n){this.sendUserProperties(e,t,"userProperties",null!=n?n:{})},e.prototype.updateFeatureFlags=function(e,t){this.sendUserProperties(e,"set","featureFlags",null!=t?t:{})},e.prototype.updateABGroups=function(e,t){this.sendUserProperties(e,"set","ABGroups",null!=t?t:{})},e.prototype.on=function(e,t){"message"===e?this.eventEmitter.on(e,t):this.transport.on(e,t)},e.prototype.off=function(e,t){"message"===e?this.eventEmitter.off(e,t):this.transport.off(e,t)},e.prototype.forceSend=function(){var e,t;null===(t=(e=this.transport).forceSend)||void 0===t||t.call(e)},e.prototype.fork=function(e){var t=(void 0===e?{}:e).enrich,n=Object.create(this);if(t){var r=this.send.bind(this);n.send=function(e,n,o,i){var s=o,a=t?t({project:e,name:n,parameters:o,overrideClientParameters:i}):{};return a&&"object"==typeof a?s=Object.assign(a,o):er("Statist: enrichment is corrupted - enrichment result must be object"),r(e,n,s,i)}}return n},e.prototype.getUtmMarkers=function(){return Un()},e.prototype.getDeviceId=function(){return Pn(this,0,void 0,(function(){return Cn(this,(function(e){return[2,this.deviceId]}))}))},e.prototype._setCodegenVersion=function(e){this.codegenVersion=e},e}(),nr=function(e){return tt._statistClientInitOptions?En(e,tt._statistClientInitOptions):e},rr=function(e){function t(t){var n=nr(t);return e.call(this,n.clientParameters,tr.createTransport(n),n.eventParameters||On(),n.sessionTimeout)||this}return kn(t,e),t.prototype.send=function(t,n,r,o){return e.prototype.send.call(this,t,n,r||{},o)},t}(tr);!function(e){function t(t){var n=nr(t);return e.call(this,n.clientParameters,tr.createTransport(t),n.eventParameters||On(),n.sessionTimeout)||this}kn(t,e),t.prototype.send=function(t,n,r,o){return e.prototype.send.call(this,t,n,r,o)}}(tr);var or,ir={};var sr,ar,ur=(or||(or=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.getTracking=function(){if("undefined"==typeof window)throw new Error("EClientOnly");return new Promise((function(e){var t=window.tracking;t&&t.fullfill?t.trackingReady?t.trackingReady().then(e):e(t):window.addEventListener("tracking-created",(function(t){t instanceof CustomEvent&&e(t.detail||window.tracking)}))}))}),ir);function cr(){return ar||(ar=1,sr=function(e){var t,n=!1;return function(){return n||(t=e.apply(void 0,arguments),n=!0),t}}),sr}var lr=e(cr());const dr=lr((()=>{var e;let t;if(document.currentScript){t=new URL((null===(e=document.currentScript)||void 0===e?void 0:e.getAttribute("src"))||"").searchParams}return t})),fr=(e,t,n)=>{try{return JSON.stringify(e,t,n)}catch(r){return((e,t,n)=>{const r=new Set,o=t||(e=>e);return JSON.stringify(e,((e,t)=>t&&"object"==typeof t?r.has(t)?"[~Circular~]":(r.add(t),o(t)):o(t)),n)})(e,t,n)}},pr=(e,t)=>t instanceof Error?Object.assign({message:t.message,stack:t.stack},t):t;class hr{constructor(e,t="all"){this.log=(e,t)=>{window.logger[this.loggerStorageName][e](Object.assign(Object.assign({},t),{name:this.loggerName}))},this.info=e=>this.log("info",e),this.warn=e=>this.log("warn",e),this.error=e=>this.log("error",e),this.fatal=e=>this.log("fatal",e),this.trace=e=>this.log("trace",e),this.debug=e=>this.log("dedug",e),this.loggerName=t,this.loggerStorageName=xt(t),window.logger||(window.logger={}),window.logger[this.loggerStorageName]=e}}const vr=(()=>{const e=Object.create(null);return{useEvent:({project:t,event:n})=>{e[t]||(e[t]=Object.create(null)),e[t][n]=!0},getUsedEvents:()=>Object.keys(e).map((t=>({projectName:t,eventList:Object.keys(e[t])})))}})();window.addEventListener("beforeunload",(()=>{const e=vr.getUsedEvents();e.length&&e.forEach((({projectName:e,eventList:t})=>{kr.sendOnce({project:"eventea",event:"usage-stats",payload:{projectName:e,eventList:t}},e)}))}));const gr=(()=>{const e=new Set,t=dr();if(t)for(const[n,r]of t)"project"===n&&e.add(r);return[...e]})(),mr=new re.ClientLoader({preloadProjects:gr,baseUrl:"https://cdn.tbank.ru/eventea/"}),yr=new class{constructor(e){this.sendLog=({logApi:e,payload:t})=>fetch(`${e}collect`,{method:"POST",keepalive:!0,headers:{"Content-type":"application/json"},body:fr(t,pr)}).catch((e=>e)),this.send=e=>{this.sendLog({logApi:this.apiURL,payload:e})},this.log=(e,t)=>{this.send(Object.assign(Object.assign({},t),{level:e}))},this.error=e=>this.log("error",e),this.info=e=>this.log("info",e),this.warn=e=>this.log("warn",e),this.fatal=e=>this.log("fatal",e),this.debug=e=>this.log("debug",e),this.trace=e=>this.log("trace",e),this.apiURL=e}}("https://www.tbank.ru/api/front/log/"),br=new hr(yr,"eventea-logger-tracking"),Sr=new hr(yr,"eventea-error-handlers"),wr=new hr(yr,"eventea-logger"),Er=new rr((()=>{const e=dr(),t={clientParameters:{ssoId:null}},n=null==e?void 0:e.get("statist-environment");n&&(t.environment=n);const r=null==e?void 0:e.get("statist-client");r&&(t.clientParameters.client=r);const o=null==e?void 0:e.get("statist-client-version");return o&&(t.clientParameters.clientVersion=o),t})()),jr={projectConfigurationMap:{},errorHandlers:(({logger:e})=>({handleMissedEvent:({event:t,project:n})=>{e.error({event:"eventea-missed-event",project:n,eventName:t})},handleMissedEventHandler:({event:t,routeHandlerName:n,project:r})=>{e.error({event:"eventea-missed-event-handler",eventName:t,project:r,routeHandlerName:n})},handleMissedProject:({event:t,project:n})=>{e.error({event:"eventea-missed-project",project:n,eventName:t})},handleMissedRouting:({project:t})=>{e.error({event:"eventea-missed-routing",project:t})},handleMissedDataHandler:({project:t,handlerName:n})=>{e.error({event:"eventea-missed-data-handler",project:t,handlerName:n})},handleMissedDataProject:({project:t})=>{e.error({event:"eventea-missed-data-project",project:t})},handleMissedRoutes:({project:t,event:n})=>{e.error({event:"eventea-missed-routes",project:t,eventName:n})},handleDeprecatedEvent:({project:t,event:n})=>{e.info({event:"eventea-deprecated-event",project:t,eventName:n})},handleEventHandlerError:(t,n,{project:r,event:o})=>{e.error({event:"eventea-handler-error",project:r,eventName:o,handlerName:n,error:t})}}))({logger:Sr}),routingClientLoader:mr,beerBaseUrl:"https://www.tbank.ru/api/front/eventea-beer/",handleAnyEvent:e=>{vr.useEvent(e)},defaultEventHandlers:{statist:Se.statistHandlerFactory({statistClient:Er}),tracking:(({logger:e})=>{const t=lr((()=>((e=6e3)=>Promise.race([ur.getTracking(),new Promise(((t,n)=>setTimeout((()=>n(new Error(`No tracking after ${e}ms timeout`))),e)))]))().then((e=>e.callUtil("makeEventeaHandler"))).catch((t=>(e.error({event:"Unable to resolve makeEventeaHandler.",error:t}),null)))));return e=>{t().then((t=>{null==t||t(e)}))}})({logger:br}),logs:(({logger:e})=>t=>{var{project:n,event:r,payload:o,handlersData:i}=t,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);r.length>o;o++)0>t.indexOf(r[o])&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(t,["project","event","payload","handlersData"]);const a=null==s?void 0:s.config,u=(()=>{const e=dr();let t="unknown";if(e)for(const[n,r]of e)if("appName"===n){t=r;break}return t})();if(a){const{level:t,samplingRate:s=1}=a;if(oe[t]&&t in e){if(0===(c=s)||1===c?c:Math.random()<=c){const s=i?Object.assign(Object.assign({},i),{statist:void 0}):i;e[t]({event:r,eventeaProject:n,payload:o,appName:u,handlersData:s,from:"browser",userAgent:window.navigator.userAgent,href:window.location.href})}return}e.error({event:"eventea-wrong-logs-config",originalEvent:r,originalLevel:t})}var c})({logger:wr})}},kr=new B.RootEventea(jr);"undefined"!=typeof window&&(window.eventea=kr,window.eventeaStatist=Er,window.__eventea=kr)}();
